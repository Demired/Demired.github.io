---
title: 账号安全
date: 2016-05-05 02:13:39
tags: linux
---

从数字元年开始，账号安全一直是为人诟病的话题，良好的密码设置与修改习惯不可或缺

为了密码更强壮，数字字母下划线，能用上的全用上

如果是账号系统开发人员，能记录登陆ip就记录一下，并适度限制ip，能防穷举就防穷举

可是这样，你以为就能阻止黑客，别做梦了，哈哈哈

## 服务器账号

1. 删除特殊的用户和用户组
2. 关闭不需要的服务
3. 关闭密码登陆
4. 使用sudo命令
5. 删减系统登录信息
6. 禁止自动重启组合键

### 用户与服务

对于服务器，服务越多，越不安全，用户越多，越不安全，所以删删删

> 添加账号

centOS添加用户

```
useradd userName
```

ubuntu添加用户

```
useradd -r -m -s /bin/bash userName
```

删除特殊的用户和用户组

常用命令

查看全部用户的详细信息

```
cat /etc/passwd
```

查看有哪些用户

```
cut -d : -f 1/etc/passwd
```

查看有哪些可登陆的用户

```
cat /etc/passwd | grep -v /sbin/nologin | cut -d : -f 1
```

查看用户操作（需要root权限）

```
w
```

查看某一用户

```
w userName
```

查看登陆用户

```
who
```

查看登陆历史纪录

```
last
```

删除用户

```
userdel userName
```

删除用户组

```
groupdel groupName
```

禁止用户登录

```
usermod -s /sbin/nologin userName
```

可以选择删除的用户

```
adm,lp,sync,shutdown,halt,news,uucp,operator,games,gopher
```

可以选择删除的用户组

```
adm,lp,news,uucp,games,dip,pppusers,popusers,slipusers
```


关闭不需要的服务

查看现有服务

```
chkconfig --list
```

关闭服务

```
chkconfig --level 345 serviceName off
```

可以选择关闭的服务

```
anacron,auditd,autofs,avahi-daemon,avahi-dnsconfd,bluetooth,cpuspeed,fistboot,gpm,haldaemon,hidd,ip6tables,ipsec,isdn,lpd,mcstrans,messagebus,netfs,nfs,nfslock,nscd,pcscd portmap,readahead_early,restorecond,rpcgssd,rpcidmapd,rstatd,sendmail,setroubleshoot,yppasswdd ypserv
```

系统运行必须的服务

acpid 电源管理

apmd 监控电池性能

kudzu 监控硬件变化

crond 监控linux的自动进程

atd 计划任务

keytables 转载镜像键盘

iptables 防火墙

xinetd 网络服务的核心守护进程

xfs x window的必要服务

network 启动网络服务

sshd 远程登陆

syslog 系统日志

### 关闭密码登陆(windows版)

在服务器暴露在外网使用密码登陆是很不安全的，所以我们可以关闭密码使用密钥

要想通过密钥的形式登陆需要满足两个条件

- 远程机器也要运行sshd服务
- 本地使用SSH客户端(Xshell)

然后就可以进行接下里的步骤了

1. 使用密码登陆远程机器并使用yum安装lrzsz远程文件上传工具

    yum install lrzsz

2. 使用SSH客户端(Xshell)生成密钥

    新建密钥，选择密钥长度，密钥类型，下一步，下一步，输入密码，导出公钥

3. 上传并安装

    在服务创建一个保存公钥的文件夹并在客户端键入rz上传到该文件夹

```
vim /etc/ssh/sshd_config

//修改如下几个配置

Protocol 2 #仅允许使用ssh2
PubkeyAuthentication yes #启用PublicKey认证
AuthorizedKeysFile /home/0x8c/key/keys #PublicKey文件路径
PasswordAuthentication no #不使用密码登陆

//重启sshd服务

/etc/rc.d/init.d/sshd restart

//然后就可以使用密钥登陆了
```

### 合理使用su sudo命令

su命令用于切换用户，常用于切换到超级用户，服务器一般禁止超级用户直接登陆，而是通过su命令切换，而在日常维护过程中很多时候是需要使用到超级用户权限的，为了避免的超级权限广泛分配，使用sudo就可以解决了

sudo被称为受限制的su，通过sudo的配置文件/etc/sudoers进行授权

例：普通用户无法访问

```
[0x8c@server ~]$ cat /etc/shadow
cat: /etc/shadow: Permission denied
```

那我们可以在/etc/sudoers中添加如下内容

```
0x8c    ALL = /bin/cat /etc/shadow
```

然后输入

```
[0x8c@server ~]$ sudo more /etc/shadow
```

你就会看到

```
[sudo] password for 0x8c:
```

输入当前用户密码你就会看到你想要的内容了，简单吧

sudo命令是使用时间戳文件来完成“检票”功能，当用户输入密码之后就可以得到一张默认存活五分钟的“门票”（默认值在编译时修改）超时需要重新输入用户密码,但是每次都需要输入密码的话，自动调用超级用户权限的程序可能就无法工作了

无需密码操作，可在/etc/sudoers中添加如下内容

```
0x8c    ALL = NOPASSWD:/bin/cat /etc/shadow
```

再尝试一下，就不需要输入密码啦！！！

还有一种方式，让当前普通用户密码就切换到超级用户，在/etc/sudoers

```
0x8c    ALL = (ALL) NOPASSWD: ALL
```

然后

```
[0x8c@server ~]$ sudo su
```

神奇发生了

```
[root@server 0x8c]#
```

设计sudo的宗旨就是：赋予用户尽可能少的权限并完成他们的工作，以后就可以使用sudo不用告诉普通用户超级用户密码啦

### 删减登陆欢迎信息

系统登陆的欢迎信息有可能包含版本信息,而有的信息可能会被黑客利用，为了保证安全可以修改以下4个文件，/etc/issue、/etc/issue.net、/etc/redhat-release、/etc/motd

/etc/issue，/etc/issue.net和/etc/redhat-release都记录了操作系统的版本号，为了安全起见，可以将文件中的内容全部清空

/etc/issue是用户通过本地终端登录后显示的，而/etc/issue.net是用户远程登陆终端显示的，默认/etc/issue.net不会在登陆之后显示，但可以去/etc/sshd_config添加如下配置

```
Banner /etc/issur.net
```

/etc/motd 是系统的公告信息，通过这个文件管理员可以发布一些公告信息，也可以对黑客发布警告信息

ssh远程登陆还是默认开始一个打印上次登录信息功能，我们可以通过修改/etc/sshd_config配置

```
PrintLastLog no
```

### 禁用Control+Alt+Delete组合键重启命令

Linux 默认同时按下Control+Alt+Delete组合键，系统将会重新启动，但这是一个很傻逼的策略，禁止的方法很简单

在/etc/init/control-alt-delete.conf

注释掉

```
exec /sbin/shutdown -r now "Control-Alt-Delete pressed"
```

就ok啦
